#!/usr/bin/env python3
"""
–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è GeoZoneChecker –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–µ–æ–∑–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
"""

from geo_zones_checker import GeoZoneChecker

def check_single_point():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–¥–Ω–æ–π —Ç–æ—á–∫–∏"""
    print("=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–¥–Ω–æ–π —Ç–æ—á–∫–∏ ===")
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º checker
    checker = GeoZoneChecker('polygons.xlsx')
    
    # –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–∏)
    lat = 55.7558  # —à–∏—Ä–æ—Ç–∞
    lon = 37.6176  # –¥–æ–ª–≥–æ—Ç–∞
    
    print(f"–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: {lat}, {lon}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –≥–µ–æ–∑–æ–Ω—ã
    results = checker.point_in_zones(lat, lon)
    
    if results:
        print(f"‚úÖ –¢–æ—á–∫–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ {len(results)} –≥–µ–æ–∑–æ–Ω(—ã)")
        for i, result in enumerate(results, 1):
            print(f"\n–ì–µ–æ–∑–æ–Ω–∞ {i}:")
            print(f"  –ò–Ω–¥–µ–∫—Å: {result['index']}")
            # –í—ã–≤–æ–¥–∏–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è
            for key, value in result.items():
                if key not in ['index', 'geometry']:
                    print(f"  {key}: {value}")
    else:
        print("‚ùå –¢–æ—á–∫–∞ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∏ –≤ –æ–¥–Ω—É –≥–µ–æ–∑–æ–Ω—É –¥–æ—Å—Ç–∞–≤–∫–∏")

def check_multiple_points():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ—á–µ–∫"""
    print("\n=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ—á–µ–∫ ===")
    
    checker = GeoZoneChecker('polygons.xlsx')
    
    # –°–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    test_points = [
        (55.7558, 37.6176, "–¶–µ–Ω—Ç—Ä –ú–æ—Å–∫–≤—ã"),
        (59.9311, 30.3609, "–¶–µ–Ω—Ç—Ä –°–ü–±"),
        (56.8431, 60.6454, "–¶–µ–Ω—Ç—Ä –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–∞"),
        # –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
    ]
    
    for lat, lon, description in test_points:
        print(f"\nüìç {description} ({lat}, {lon}):")
        results = checker.point_in_zones(lat, lon)
        
        if results:
            print(f"  ‚úÖ –ü–æ–ø–∞–¥–∞–µ—Ç –≤ {len(results)} –≥–µ–æ–∑–æ–Ω(—ã)")
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –≥–µ–æ–∑–æ–Ω—É –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏
            if results:
                first_result = results[0]
                print(f"  –ü–µ—Ä–≤–∞—è –≥–µ–æ–∑–æ–Ω–∞ (–∏–Ω–¥–µ–∫—Å {first_result['index']}):")
                for key, value in first_result.items():
                    if key not in ['index', 'geometry', 'WKT'] and value is not None:
                        print(f"    {key}: {value}")
        else:
            print("  ‚ùå –ù–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –≥–µ–æ–∑–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏")

def add_cities_to_file():
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥–æ—Ä–æ–¥–∞—Ö –≤ —Ñ–∞–π–ª"""
    print("\n=== –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤ –≤ —Ñ–∞–π–ª ===")
    
    checker = GeoZoneChecker('polygons.xlsx')
    
    # –í–ù–ò–ú–ê–ù–ò–ï: —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏!
    # –î–ª—è –∫–∞–∂–¥–æ–π –≥–µ–æ–∑–æ–Ω—ã –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω –∑–∞–ø—Ä–æ—Å –∫ API
    
    response = input("–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥–æ—Ä–æ–¥–∞—Ö? –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (y/N): ")
    
    if response.lower() in ['y', 'yes', '–¥–∞']:
        print("–ù–∞—á–∏–Ω–∞—é –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥–æ—Ä–æ–¥–∞—Ö...")
        print("–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≥–µ–æ–∑–æ–Ω")
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≥–æ—Ä–æ–¥–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∫–∞–∂–¥—ã–µ 5 –∑–∞–ø–∏—Å–µ–π
        checker.add_city_column('polygons_with_cities.xlsx', batch_size=5)
        
        print("‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ—Ä–æ–¥–∞—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ñ–∞–π–ª polygons_with_cities.xlsx")
    else:
        print("–ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤")

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üó∫Ô∏è  –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–æ–∑–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤")
    print("=" * 50)
    
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–¥–Ω—É —Ç–æ—á–∫—É
        check_single_point()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ—á–µ–∫
        check_multiple_points()
        
        # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –≥–æ—Ä–æ–¥–∞
        add_cities_to_file()
        
    except FileNotFoundError:
        print("‚ùå –§–∞–π–ª polygons.xlsx –Ω–µ –Ω–∞–π–¥–µ–Ω!")
        print("–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ —á—Ç–æ –∏ —Å–∫—Ä–∏–ø—Ç")
    except Exception as e:
        print(f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {e}")

if __name__ == "__main__":
    main()