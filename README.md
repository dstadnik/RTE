# Проверка геозон доставки ресторанов

Этот проект позволяет:
1. Проверить, попадает ли геоточка в зоны доставки ресторанов
2. Добавить информацию о городе для каждой геозоны

## Установка

1. Установите необходимые зависимости:
```bash
pip install -r requirements.txt
```

2. Убедитесь, что файл `polygons.xlsx` находится в папке с проектом

## Использование

### Быстрый старт

Запустите пример:
```bash
python example_usage.py
```

### Программное использование

```python
from geo_zones_checker import GeoZoneChecker

# Инициализация
checker = GeoZoneChecker('polygons.xlsx')

# Проверка точки
lat, lon = 55.7558, 37.6176  # Москва
results = checker.point_in_zones(lat, lon)

if results:
    print(f"Точка попадает в {len(results)} геозон(ы)")
    for result in results:
        print(f"Ресторан: {result.get('restaurant_name', 'Неизвестно')}")
else:
    print("Точка не в зоне доставки")
```

### Добавление информации о городах

```python
# ВНИМАНИЕ: может занять много времени!
checker.add_city_column('polygons_with_cities.xlsx')
```

## Структура файла

Файл `polygons.xlsx` должен содержать колонку `WKT` с геометрией полигонов в формате Well-Known Text.

Пример WKT:
```
POLYGON((37.5 55.7, 37.6 55.7, 37.6 55.8, 37.5 55.8, 37.5 55.7))
```

## Методы класса GeoZoneChecker

### `__init__(polygons_file: str)`
Инициализирует checker с файлом полигонов

### `point_in_zones(lat: float, lon: float) -> List[dict]`
Проверяет попадание точки в геозоны
- **lat**: широта точки
- **lon**: долгота точки
- **Возвращает**: список словарей с информацией о пересекающихся геозонах

### `add_city_column(save_file: str, batch_size: int = 10)`
Добавляет колонку с городом для каждой геозоны
- **save_file**: путь для сохранения обновленного файла
- **batch_size**: количество запросов перед промежуточным сохранением

### `save_data(filename: str)`
Сохраняет данные в Excel или CSV файл

## Примеры координат для тестирования

- Москва: 55.7558, 37.6176
- Санкт-Петербург: 59.9311, 30.3609
- Екатеринбург: 56.8431, 60.6454
- Новосибирск: 55.0084, 82.9357

## Ограничения

1. Для получения информации о городах используется бесплатный API Nominatim
2. Есть ограничения на количество запросов (1 запрос в секунду)
3. Большое количество геозон может потребовать много времени для обработки

## Формат вывода

При проверке точки возвращается список словарей с полями:
- `index`: индекс записи в исходном файле
- `geometry`: геометрия Shapely
- Все остальные колонки из исходного файла

## Обработка ошибок

Скрипт обрабатывает:
- Некорректные WKT строки
- Ошибки сети при запросах к API
- Отсутствующие файлы
- Неподдерживаемые форматы файлов